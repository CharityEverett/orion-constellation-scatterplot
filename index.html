<!DOCTYPE html>
<html>
<head>
    <title>Orion Cluster Hertzsprung-Russell Scatterplot </title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
</head>
<body>
    <a-scene renderer="precision: medium"  bloom="radius: 0.75; strength: 0.5; threshold: 0.1">
        <!-- Lighting -->
        <a-entity light="type: ambient; color: #FFF; intensity: 0.8"></a-entity>
        <a-entity light="type: directional; color: #FFF; intensity: 1" position="-1 1 0"></a-entity>

        <!-- Reference sphere -->
        <a-sphere position="0 0 -5" 
                  radius="1" 
                sphere.setAttribute('material', {
    shader: 'flat',
    color: starColor,
    emissive: starColor,
    emissiveIntensity: 1,
    opacity: 0.9
});
        </a-sphere>

        <!-- Stars container -->
        <a-entity id="starfield"></a-entity>
        
        <!-- Skybox -->
        <a-sky src="https://cdn.glitch.global/5cfc02c2-e08f-4e29-9383-05c3fa57335f/skybox_equirectangular.png?v=1732135394692"></a-sky>
        
        <!-- Camera rig -->
        <a-entity position="0 1.6 0">
            <a-camera look-controls wasd-controls>
                <a-cursor
                    id="cursor"
                    material="color: white; shader: flat"
                    position="0 0 -1"
                    geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                    raycaster="objects: .clickable">
                </a-cursor>
            </a-camera>
        </a-entity>
    </a-scene>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const starfield = document.getElementById('starfield');
        
        // Define spectral class colors
        const spectralColors = {
            'O': '#FF0000', // Red
            'B': '#FF7F00', // Orange
            'A': '#FFFF00', // Yellow
            'F': '#00FF00', // Green
            'G': '#0000FF', // Blue
            'K': '#4B0082', // Indigo
            'M': '#9400D3'  // Violet
        };

        function getSpectralColor(spectralClass) {
            return spectralColors[spectralClass[0]] || '#ffffff';
        }

        fetch('https://dieghernan.github.io/celestial_data/data/stars.6.geojson')
    .then(response => response.json())
    .then(data => {
        const stars = data.features.filter(star => 
            star.properties.mag !== undefined && star.properties['B-V'] !== undefined
        );

        const magMin = Math.min(...stars.map(s => s.properties.mag));
        const magMax = Math.max(...stars.map(s => s.properties.mag));
        const colorMin = Math.min(...stars.map(s => s.properties['B-V']));
        const colorMax = Math.max(...stars.map(s => s.properties['B-V']));

        // New scale factor to restore original size
        const newScaleFactor = 5.0;

        stars.forEach(star => {
            const sphere = document.createElement('a-sphere');
            
            const magnitude = star.properties.mag;
            const colorIndex = star.properties['B-V'];

            // Normalize positions and apply new scale factor
            const x = (((colorIndex - colorMin) / (colorMax - colorMin) * 10) - 5) * newScaleFactor;
            const y = (((magnitude - magMin) / (magMax - magMin) * -10) + 5) * newScaleFactor;
            const z = -5; // Fixed distance in front of the camera

            sphere.setAttribute('position', `${x} ${y} ${z}`);
            
            sphere.setAttribute('radius', getStarSize(magnitude));
            
            const starColor = getColorFromIndex(colorIndex);
            
            sphere.setAttribute('material', {
                shader: 'flat',
                color: starColor,
                opacity: 0.8
            });
            
            sphere.setAttribute('class', 'clickable');
            sphere.setAttribute('title', star.properties.name || 'Unnamed star');

            sphere.addEventListener('mouseenter', function () {
                this.setAttribute('scale', '1.2 1.2 1.2');
            });
            sphere.addEventListener('mouseleave', function () {
                this.setAttribute('scale', '1 1 1');
            });
            
            starfield.appendChild(sphere);
        });
    })
    .catch(error => console.error('Error:', error));
    });
    </script>
</body>
</html>
