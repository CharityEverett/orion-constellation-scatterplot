<!DOCTYPE html>
<html>
<head>
    <title>Orion Star Cluster Hertsprung-Russell Scatterplot</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> 
</head>
<body>

        <!-- Canvas Plot -->
    <canvas id="hrDiagram" width="800" height="600"></canvas>
   <a-scene renderer="precision: medium">
       
    <!-- Lighting -->
    <a-entity light="type: ambient; color: #FFF; intensity: 0.8"></a-entity>
    <a-entity light="type: directional; color: #FFF; intensity: 1" position="-1 1 0"></a-entity>

    <!-- Axes -->
    <a-entity line="start: 0 0 0; end: 10 0 0; color: red" position="-5 0 0"></a-entity>
    <a-entity line="start: 0 0 0; end: 0 10 0; color: green" position="0 -5 0"></a-entity>
    <a-entity line="start: 0 0 0; end: 0 0 10; color: blue" position="0 0 -5"></a-entity>

    <!-- Axis Labels -->
    <a-text value="Temperature" position="5 0 0" rotation="0 -90 0" align="center"></a-text>
    <a-text value="Luminosity" position="0 5 0" rotation="0 0 90" align="center"></a-text>
    <a-text value="Radius" position="0 0 5" rotation="0 0 0" align="center"></a-text>

    <!-- Stars container -->
    <a-entity id="starfield"></a-entity>

    <!-- Skybox -->
    <a-sky src="https://cdn.glitch.global/5cfc02c2-e08f-4e29-9383-05c3fa57335f/skybox_equirectangular.png?v=1732135394692"></a-sky>

    <!-- Camera rig -->
    <a-entity position="0 0 15">
        <a-camera look-controls wasd-controls>
            <a-cursor
                id="cursor"
                material="color: white; shader: flat"
                position="0 0 -1"
                geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                raycaster="objects: .clickable">
            </a-cursor>
        </a-camera>
    </a-entity>
</a-scene>

   <script>
    const stefanBoltzmannConstant = 5.670374419e-8;
    const solarLuminosity = 3.828e26;
    const solarRadius = 6.957e8;

    function calculateRadius(luminosity, temperature) {
        const luminosityWatts = luminosity * solarLuminosity;
        const radiusMeters = Math.sqrt(luminosityWatts / (4 * Math.PI * stefanBoltzmannConstant * Math.pow(temperature, 4)));
        return radiusMeters / solarRadius;
    }

    fetch('https://dieghernan.github.io/celestial_data/data/stars.6.geojson')
        .then(response => response.json())
        .then(data => {
            const stars = data.features;
            const plotData = stars.reduce((acc, star) => {
                const mag = star.properties.mag;
                const bv = star.properties.bv;

                if (bv !== undefined && bv !== null && mag !== undefined && mag !== null) {
                    const temperature = 4600 * ((1 / (0.92 * bv + 1.7)) + (1 / (0.92 * bv + 0.62)));
                    const distance = 10; // Placeholder distance in parsecs
                    const absoluteMagnitude = mag - 5 * (Math.log10(distance) - 1);
                    const luminosity = Math.pow(10, (4.83 - absoluteMagnitude) / 2.5);
                    const starRadius = calculateRadius(luminosity, temperature);

                    acc.push({
                        x: temperature,
                        y: luminosity,
                        r: starRadius * 10 // Scale radius for visibility
                    });
                }
                return acc;
            }, []);

            const ctx = document.getElementById('hrDiagram').getContext('2d');
            new Chart(ctx, {
                type: 'bubble',
                data: {
                    datasets: [{
                        label: 'Stars',
                        data: plotData,
                        backgroundColor: 'rgba(255, 255, 255, 1)'
                    }]
                },
                options: {
                    scales: {
                        x: {
                            type: 'logarithmic',
                            reverse: true,
                            title: {
                                display: true,
                                text: 'Temperature (K)'
                            }
                        },
                        y: {
                            type: 'logarithmic',
                            title: {
                                display: true,
                                text: 'Luminosity (Lâ˜‰)'
                            }
                        }
                    }
                }
            });
        })
        .catch(error => console.error('Error fetching data:', error));
</script>
</body>
</html>
