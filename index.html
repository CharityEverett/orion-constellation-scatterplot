<!DOCTYPE html>
<html>
<head>
    <title>Orion Star Cluster Hertsprung-Russell Scatterplot</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> 
</head>
<body>
   <a-scene renderer="precision: medium">
    <!-- Canvas Plot -->
    <canvas id="hrDiagram" width="800" height="600"></canvas>
       
    <!-- Lighting -->
    <a-entity light="type: ambient; color: #FFF; intensity: 0.8"></a-entity>
    <a-entity light="type: directional; color: #FFF; intensity: 1" position="-1 1 0"></a-entity>

    <!-- Axes -->
    <a-entity line="start: 0 0 0; end: 10 0 0; color: red" position="-5 0 0"></a-entity>
    <a-entity line="start: 0 0 0; end: 0 10 0; color: green" position="0 -5 0"></a-entity>
    <a-entity line="start: 0 0 0; end: 0 0 10; color: blue" position="0 0 -5"></a-entity>

    <!-- Axis Labels -->
    <a-text value="Temperature" position="5 0 0" rotation="0 -90 0" align="center"></a-text>
    <a-text value="Luminosity" position="0 5 0" rotation="0 0 90" align="center"></a-text>
    <a-text value="Radius" position="0 0 5" rotation="0 0 0" align="center"></a-text>

    <!-- Stars container -->
    <a-entity id="starfield"></a-entity>

    <!-- Skybox -->
    <a-sky src="https://cdn.glitch.global/5cfc02c2-e08f-4e29-9383-05c3fa57335f/skybox_equirectangular.png?v=1732135394692"></a-sky>

    <!-- Camera rig -->
    <a-entity position="0 0 15">
        <a-camera look-controls wasd-controls>
            <a-cursor
                id="cursor"
                material="color: white; shader: flat"
                position="0 0 -1"
                geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                raycaster="objects: .clickable">
            </a-cursor>
        </a-camera>
    </a-entity>
</a-scene>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
    const starfield = document.getElementById('starfield');
    const scaleFactor = 0.05;

    fetch('https://dieghernan.github.io/celestial_data/data/stars.6.geojson')
        .then(response => response.json())
        .then(data => {
            const stars = data.features

                
                .filter(star => star.properties.mag < 5)
                .slice(0, 200);

            stars.forEach(star => {
                const sphere = document.createElement('a-sphere');
                
                // Assuming temperature, luminosity, and radius are available in star properties
                const temperature = star.properties.temperature || 5000; // Default value if not available
                const luminosity = star.properties.luminosity || 1; // Default value if not available
                const radius = star.properties.radius || 1; // Default value if not available

                // Map temperature to x-axis (inverted), luminosity to y-axis, and radius to z-axis
                const x = -temperature * scaleFactor;
                const y = Math.log10(luminosity) * scaleFactor;
                const z = radius * scaleFactor;

                sphere.setAttribute('position', `${x} ${y} ${z}`);
                sphere.setAttribute('radius', '0.1');
                sphere.setAttribute('color', '#FFFFFF');
                sphere.setAttribute('material', {
                    shader: 'flat',
                    opacity: 0.8
                });
                sphere.setAttribute('class', 'clickable');
const stefanBoltzmannConstant = 5.670374419e-8;
const solarLuminosity = 3.828e26; // Solar luminosity in watts
const solarRadius = 6.957e8; // Solar radius in meters

function calculateRadius(luminosity, temperature) {
    // Convert luminosity to watts (assuming input is in solar luminosities)
    const luminosityWatts = luminosity * solarLuminosity;
    
    // Calculate radius in meters
    const radiusMeters = Math.sqrt(luminosityWatts / (4 * Math.PI * stefanBoltzmannConstant * Math.pow(temperature, 4)));
    
    // Convert to solar radii
    return radiusMeters / solarRadius;
}

const temperatures = [];
const luminosities = [];
const radii = [];

stars.forEach(star => {
    const mag = star.properties.mag;
    const bv = star.properties.bv;

    if (bv !== undefined && bv !== null && mag !== undefined && mag !== null) {
        // Calculate temperature from B-V color index
        const temperature = 4600 * ((1 / (0.92 * bv + 1.7)) + (1 / (0.92 * bv + 0.62)));

        // Calculate luminosity from apparent magnitude
        const distance = 10; // Placeholder distance in parsecs
        const absoluteMagnitude = mag - 5 * (Math.log10(distance) - 1);
        const luminosity = Math.pow(10, (4.83 - absoluteMagnitude) / 2.5);

        // Calculate radius using Stefan-Boltzmann law
        const radius = calculateRadius(luminosity, temperature);

        // Push calculated values to arrays
        temperatures.push(temperature);
        luminosities.push(luminosity);
        radii.push(radius);
    }
});
    
    const radius = calculateRadius(luminosity, temperature);
const radius = calculateRadius(luminosity, temperature);
radii.push(radius);
});
                // Add star name label (if available)
                if (star.properties.name) {
                    const text = document.createElement('a-text');
                    text.setAttribute('value', star.properties.name);
                    text.setAttribute('align', 'center');
                    text.setAttribute('position', '0 0.5 0');
                    text.setAttribute('scale', '0.5 0.5 0.5');
                    text.setAttribute('visible', false);
                    sphere.appendChild(text);

                    sphere.addEventListener('mouseenter', () => {
                        text.setAttribute('visible', true);
                    });
                    sphere.addEventListener('mouseleave', () => {
                        text.setAttribute('visible', false);
                    });
                }

                starfield.appendChild(sphere);
            });
        })
        .catch(error => console.error('Error:', error));
});
    </script>
</body>
</html>
